<%= javascript_include_tag "builder/container" %>
<%= javascript_include_tag "builder/builder-ui" %>

<% content_for :head do -%>
<script type="text/javascript">
  $(document).ready(function() {
      $('#edit_query_<%= @query.id%>').submit(function() {
        $('#query_query_structure').val(builder.generateJson());
        return true;
      });
  });
</script>
<% end -%>


<%= render partial: 'shared/tab_menu', locals: { selected: {queries: true}}%>

<div id="mainPanel">

  <h1>Editing Query</h1>

  <%= simple_form_for @query do |f| %>

  <table class="simpleTable">
    <tr><td>Title</td><td><%= f.input_field :title, :disabled => @disabled %></td></tr>
    <tr><td>Description</td><td><%= f.input_field :description, :disabled => @disabled %></td></tr>
  </table>
  
  <%= f.hidden_field :query_structure %>

  <h2>Demographics</h2>
  <div id="builder">
    <table>
      <% HQUERY_VARIABLES[:demographics][:options].each do |demographic| %>
        <tr>
          <td>
            <input type="checkbox" class="demographics_toggle" id="<%= demographic[:id] %>"> <%= demographic[:long_name] %>
          </td>
          <td>
            <select id="<%= demographic[:id] %>_comparison"><option>=</option><option>&lt;</option><option>&gt;</option></select>
          </td>
          <td>
            <input id="<%= demographic[:id] %>_value" type="text"/>
          </td>
        </tr>
      <% end %>
    </table>
  </div>

  <h2>Endpoints</h2>
  <%= render :partial=>"endpoint" %>

  <div class="ctrl"> 
    <%= f.button :submit if !@disabled %>
    <% if (not @query.id.nil?) %>
      <%= link_to 'cancel', @query %>
    <% else %>
      <%= link_to 'cancel', queries_path %>
    <% end %> 
  </div>
  <% end %>
  
</div>
