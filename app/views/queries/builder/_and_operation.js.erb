<%
  # This partial defines the "and" operation. Given a set of assertions, i.e. functions defined by sub-elements in the query_structure, we
  # will check to see if all of them are true. An empty list returns true.
  #
  # Locals
  # parent_id - The stored ID of the query structure element that called this partial. Used to mark variables in our outputted javascript for slightly better readabillity.
  # query_substructure - A fragment of the query structure whose top element is an "and" operation. Our assertions come from the associated array.
%>

function() {
  <%= render :partial => "/queries/builder/assertions", :locals => { :query_substructure => query_substructure, :parent_id => parent_id } %>

  <% # If one or more , return true. If we had 0 assertions, also return true. %>
  if (assertions_<%= parent_id %>.length == 0) {
    return true;
  }
  for (var i = 0; i < assertions_<%= parent_id %>.length; i++) {
    if (!assertions_<%= parent_id %>[i]) {
      return false;
    }
  }
  return true;
}