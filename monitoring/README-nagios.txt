This README documents local Nagios configuration modifications used to
monitor the PDC network.  When a new endpoint is added, items 3 and 7
need to be reviewed.

1. Updates required in /etc/nagios3/conf.d/contacts_nagios2.cfg

a) Add the following contact information
define contact{
        contact_name                    derek
        alias                           derek
        service_notification_period     24x7
        host_notification_period        24x7
        service_notification_options    w,u,c,r
        host_notification_options       d,r
        service_notification_commands   notify-service-by-email
        host_notification_commands      notify-host-by-email
        email                           derek.roberts@gmail.com
        }

define contact{
        contact_name                    fieran
        alias                           fieran
        service_notification_period     24x7
        host_notification_period        24x7
        service_notification_options    w,u,c,r
        host_notification_options       d,r
        service_notification_commands   notify-service-by-email
        host_notification_commands      notify-host-by-email
        email                           fieranmason@gmail.com
        }

define contact{
        contact_name                    simon
        alias                           simon
        service_notification_period     24x7
        host_notification_period        24x7
        service_notification_options    w,u,c,r
        host_notification_options       d,r
        service_notification_commands   notify-service-by-email
        host_notification_commands      notify-host-by-email
        email                           simon.diemert@gmail.com
        }

b) Modify the members entry of the admins contactgroup in
/etc/nagios3/conf.d/contacts_nagios2.cfg to:

        members                 fieran,simon,derek


2. Add file /etc/nagios3/conf.d/noping-host.cfg.  This file is exactly
the same as /etc/nagios3/conf.d/generic-host_nagios2.cfg except that
the line with check_command is commented out:

Change line:
   		check_command                   check-host-alive
to:
		;check_command                   check-host-alive

The normal check-host-alive command uses ping but the endpoint servers
are behind a firewall so they do not respond to ping.  Instead, each
endpoint has an entry similar to the following:

define host{
        use                     noping-host
        host_name               pdc-nnn
	check_command		check_alive_pdcnnn
        }

The check_alive_pdcnnn uses the Nagios plugin check_http to determine
whether the endpoint's query-gateway is responding to http requests.
If it is, then the endpoint is considered UP.

3.  Each endpoint will have a configuration file similar to
/etc/nagios3/conf.d/pdc-nnn.cfg with one "define host" entry like that
described above and multiple "define service" commands.  These
configuration files are auto-generated.

4.  Create a configuration file for the hub by copying
/etc/nagios3/conf.d/localhost_nagios2.cfg to pdchub.cfg.  Replace all
references to localhost with the DNS name of the hub, for instance
pdchub.uvic.ca, and replace the localhost IP address of 127.0.0.1 with
the correct IP address for the PDC hub.  This step is not necessary if
Nagios runs on the same host as the hub software.

5.  Add to /etc/nagios3/conf.d/timeperiods_nagios2.cfg the following
timeperiod definition.  This entry is needed because Tomcat will not
run on the Oscar endpoints during times when the Oscar database is
being reloaded with the most recent MySQL dump available.

-------------(start)-------------
# Period when Tomcat server on Oscar EMR endpoints should be running
define timeperiod{
        timeperiod_name importhours
        alias           E2E Import Hours
        sunday          09:30-22:00
        monday          09:30-22:00
        tuesday         09:30-22:00
        wednesday       09:30-22:00
        thursday        09:30-22:00
        friday          09:30-22:00
        saturday        09:30-22:00
        }
-------------( end )-------------

6.  Add to /etc/nagios3/conf.d/services_nagios2.cfg the following:

-------------(start)-------------
# generic service for Tomcat checks ("use importhours-service,generic-service")
define service {
	name			importhours-service
	check_period		importhours
	register		0
}
-------------( end )-------------

7.  Append to /etc/nagios3/commands.cfg the commands used for host and
service checks.  They are autogenerated and will have the general
form:

# commands to check endpoint pdc-NNN
define command{
        command_name    check_alive_pdcNNN
        command_line    $USER1$/check_nrpe -H 142.104.90.75 -c check_alive_pdcNNN
}

define command{
        command_name    diskspace_pdcNNN
        command_line    $USER1$/check_nrpe -H 142.104.90.75 -c check_diskspace_pdcNNN
}

define command{
        command_name    import_pdcNNN
        command_line    $USER1$/check_nrpe -H 142.104.90.75 -c check_import_pdcNNN
}

define command{
        command_name    load_pdcNNN
        command_line    $USER1$/check_nrpe -H 142.104.90.75 -c check_load_pdcNNN
}

define command{
        command_name    processes_pdcNNN
        command_line    $USER1$/check_nrpe -H 142.104.90.75 -c check_processes_pdcNNN
}

define command{
        command_name    swap_pdcNNN
        command_line    $USER1$/check_nrpe -H 142.104.90.75 -c check_swap_pdcNNN
}

define command{
        command_name    tomcat_pdcNNN
        command_line    $USER1$/check_nrpe -H 142.104.90.75 -c check_tomcat_pdcNNN
}

define command{
        command_name    users_pdcNNN
        command_line    $USER1$/check_nrpe -H 142.104.90.75 -c check_users_pdcNNN
}
